generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["interactiveTransactions"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Pessoa {
    id                  Int                 @id @default(autoincrement())
    email               String              @unique
    senha               String
    nome_exibicao       String
    nome_completo       String
    atualizado_em       DateTime            @default(now()) @db.Timestamptz(6)
    atualizado_por      Int?
    criado_em           DateTime            @default(now()) @db.Timestamptz(6)
    criado_por          Int?
    qtde_senha_invalida Int                 @default(0)
    senha_atualizada_em DateTime?           @default(now()) @db.Timestamptz(6)
    senha_bloqueada     Boolean             @default(false)
    senha_bloqueada_em  DateTime?           @default(now()) @db.Timestamptz(6)
    desativado          Boolean             @default(false)
    desativado_em       DateTime?
    desativado_por      Int?
    desativado_motivo   String?
    pessoa_fisica_id    Int?
    atualizador         Pessoa?             @relation("AtualizadorPessoas", fields: [atualizado_por], references: [id])
    criador             Pessoa?             @relation("CriadorPessoas", fields: [criado_por], references: [id])
    desativador         Pessoa?             @relation("DesativadorPessoas", fields: [desativado_por], references: [id])
    pessoa_fisica       PessoaFisica?       @relation(fields: [pessoa_fisica_id], references: [id])
    PessoasQueAtualizei Pessoa[]            @relation("AtualizadorPessoas")
    PessoasQueCriei     Pessoa[]            @relation("CriadorPessoas")
    PessoasQueDesativei Pessoa[]            @relation("DesativadorPessoas")
    PessoaPerfil        PessoaPerfil[]
    PessoaSessoesAtivas PessoaSessaoAtiva[]

    OrgaoQueCriei     Orgao[] @relation("Criador")
    OrgaoQueRemovi    Orgao[] @relation("Removedor")
    OrgaoQueAtualizei Orgao[] @relation("Atualizador")

    TipoOrgaoQueCriei     TipoOrgao[] @relation("Criador")
    TipoOrgaoQueRemovi    TipoOrgao[] @relation("Removedor")
    TipoOrgaoQueAtualizei TipoOrgao[] @relation("Atualizador")

    OdsQueCriei     Ods[] @relation("Criador")
    OdsQueRemovi    Ods[] @relation("Removedor")
    OdsQueAtualizei Ods[] @relation("Atualizador")

    SubTemaQueCriei     SubTema[] @relation("Criador")
    SubTemaQueRemovi    SubTema[] @relation("Removedor")
    SubTemaQueAtualizei SubTema[] @relation("Atualizador")

    EixoQueCriei     MacroTema[] @relation("Criador")
    EixoQueRemovi    MacroTema[] @relation("Removedor")
    EixoQueAtualizei MacroTema[] @relation("Atualizador")

    PDMQueCriei     Pdm[] @relation("Criador")
    PDMQueDesativei Pdm[] @relation("Desativador")
    PDMQueAtualizei Pdm[] @relation("Atualizador")

    OEQueCriei     Tema[] @relation("Criador")
    OEQueDesativei Tema[] @relation("Removedor")
    OEQueAtualizei Tema[] @relation("Atualizador")

    TagQueCriei     Tag[] @relation("Criador")
    TagQueDesativei Tag[] @relation("Removedor")
    TagQueAtualizei Tag[] @relation("Atualizador")

    FRQueCriei     FonteRecurso[] @relation("Criador")
    FRQueDesativei FonteRecurso[] @relation("Removedor")
    FRQueAtualizei FonteRecurso[] @relation("Atualizador")

    TipoDocQueCriei     TipoDocumento[] @relation("Criador")
    TipoDocQueDesativei TipoDocumento[] @relation("Removedor")
    TipoDocQueAtualizei TipoDocumento[] @relation("Atualizador")

    RegiaoQueCriei     Regiao[] @relation("Criador")
    RegiaoQueDesativei Regiao[] @relation("Removedor")
    RegiaoQueAtualizei Regiao[] @relation("Atualizador")

    ArquivoQueCriei Arquivo[] @relation("Criador")

    ArquivoDocQueCriei     ArquivoDocumento[] @relation("Criador")
    ArquivoDocQueDesativei ArquivoDocumento[] @relation("Removedor")
    ArquivoDocQueAtualizei ArquivoDocumento[] @relation("Atualizador")

    MetaQueCriei     Meta[] @relation("Criador")
    MetaQueDesativei Meta[] @relation("Desativador")
    MetaQueAtualizei Meta[] @relation("Atualizador")

    MetasQueSouResp MetaResponsavel[] @relation("MetaPessoaResp")

    IndicadorQueCriei     Indicador[] @relation("Criador")
    IndicadorQueRemovi    Indicador[] @relation("Removedor")
    IndicadorQueAtualizei Indicador[] @relation("Atualizador")

    UnidadeQueCriei     UnidadeMedida[]     @relation("Criador")
    UnidadeQueRemovi    UnidadeMedida[]     @relation("Removedor")
    UnidadeQueAtualizei UnidadeMedida[]     @relation("Atualizador")
    IndicadorVariavel   IndicadorVariavel[] @relation("Desativador")

    IniciativasQueCriei     Iniciativa[]            @relation("Criador")
    IniciativasQueRemovi    Iniciativa[]            @relation("Removedor")
    IniciativasQueAtualizei Iniciativa[]            @relation("Atualizador")
    IniciativasQueSouResp   IniciativaResponsavel[] @relation("IniciativaPessoaResp")

    AtividadesQueCriei     Atividade[]            @relation("Criador")
    AtividadesQueRemovi    Atividade[]            @relation("Removedor")
    AtividadesQueAtualizei Atividade[]            @relation("Atualizador")
    AtividadesQueSouResp   AtividadeResponsavel[] @relation("AtividadePessoaResp")

    VariavelResponsavel    VariavelResponsavel[]
    AtualizouSerieVariavel SerieVariavel[]       @relation("Atualizador")
    ConferiuSerieVariavel  SerieVariavel[]       @relation("Conferidor")

    CronogramaOrgao         CronogramaOrgao[]
    CronogramasQueCriei     Cronograma[]      @relation("Criador")
    CronogramasQueRemovi    Cronograma[]      @relation("Removedor")
    CronogramasQueAtualizei Cronograma[]      @relation("Atualizador")

    EtapasQueCriei     Etapa[] @relation("Criador")
    EtapasQueRemovi    Etapa[] @relation("Removedor")
    EtapasQueAtualizei Etapa[] @relation("Atualizador")

    PaineisQueCriei     Painel[]          @relation("Criador")
    PaineisQueRemovi    Painel[]          @relation("Removedor")
    PaineisQueAtualizei Painel[]          @relation("Atualizador")
    PessoaAcessoPdm     PessoaAcessoPdm[]

    GruposDePaineisQueCriei                 GrupoPainel[]                    @relation("Criador")
    GruposDePaineisQueRemovi                GrupoPainel[]                    @relation("Removedor")
    GruposDePaineisQueParticipo             PessoaGrupoPainel[]
    VariavelCicloFisicoQualitativoCriador   VariavelCicloFisicoQualitativo[] @relation("criador")
    VariavelCicloFisicoQualitativoRemovedor VariavelCicloFisicoQualitativo[] @relation("removedor")
    VariavelCicloFisicoDocumentoCriador     VariavelCicloFisicoDocumento[]   @relation("criador")
    VariavelCicloFisicoDocumentoRemovedor   VariavelCicloFisicoDocumento[]   @relation("removedor")
    PedidoComplementacaoCriador             PedidoComplementacao[]           @relation("criador")
    PedidoComplementacaoAtendeu             PedidoComplementacao[]           @relation("atendeu")
    PedidoComplementacaoRemovedor           PedidoComplementacao[]           @relation("removedor")
    MetaCicloFisicoAnaliseCriador           MetaCicloFisicoAnalise[]         @relation("criador")
    MetaCicloFisicoAnaliseRemovedor         MetaCicloFisicoAnalise[]         @relation("removedor")
    MetaCicloFisicoFechamentoCriador        MetaCicloFisicoFechamento[]      @relation("criador")
    MetaCicloFisicoFechamentoRemovedor      MetaCicloFisicoFechamento[]      @relation("removedor")

    MetaCicloFisicoRiscoCriador              MetaCicloFisicoRisco[]            @relation("criador")
    MetaCicloFisicoRiscoRemovedor            MetaCicloFisicoRisco[]            @relation("removedor")
    MetaCicloFisicoAnaliseDocumentoCriador   MetaCicloFisicoAnaliseDocumento[] @relation("criador")
    MetaCicloFisicoAnaliseDocumentoRemovedor MetaCicloFisicoAnaliseDocumento[] @relation("removedor")

    @@map("pessoa")
}

model Modulo {
    id         Int          @id @default(autoincrement())
    codigo     String       @unique
    descricao  String
    privilegio Privilegio[]

    @@map("modulo")
}

model Orgao {
    id            Int            @id @default(autoincrement())
    sigla         String?
    descricao     String
    tipo_orgao_id Int
    tipo_orgao    TipoOrgao      @relation(fields: [tipo_orgao_id], references: [id])
    pessoa_fisica PessoaFisica[]

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador            Pessoa?                 @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador                Pessoa?                 @relation("Criador", fields: [criado_por], references: [id])
    removedor              Pessoa?                 @relation("Removedor", fields: [removido_por], references: [id])
    meta_orgao             MetaOrgao[]
    meta_responsavel       MetaResponsavel[]
    Variavel               Variavel[]
    iniciativa_orgao       IniciativaOrgao[]
    iniciativa_responsavel IniciativaResponsavel[]
    atividade_orgao        AtividadeOrgao[]
    atividade_responsavel  AtividadeResponsavel[]
    CronogramaOrgao        CronogramaOrgao[]

    @@map("orgao")
}

model PerfilAcesso {
    id                Int                @id @default(autoincrement())
    nome              String
    descricao         String?
    perfil_privilegio PerfilPrivilegio[]
    pessoa_perfil     PessoaPerfil[]

    @@map("perfil_acesso")
}

model PerfilPrivilegio {
    id               Int          @id @default(autoincrement())
    perfil_acesso_id Int
    privilegio_id    Int
    perfil_acesso    PerfilAcesso @relation(fields: [perfil_acesso_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
    privilegio       Privilegio   @relation(fields: [privilegio_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

    @@unique([perfil_acesso_id, privilegio_id])
    @@map("perfil_privilegio")
}

model PessoaFisica {
    id Int @id @default(autoincrement())

    cargo                String?
    lotacao              String?
    orgao_id             Int
    orgao                Orgao    @relation(fields: [orgao_id], references: [id])
    pessoa               Pessoa[]
    registro_funcionario String?
    cpf                  String?

    @@map("pessoa_fisica")
}

model PessoaPerfil {
    id               Int          @id @default(autoincrement())
    pessoa_id        Int
    perfil_acesso_id Int
    perfil_acesso    PerfilAcesso @relation(fields: [perfil_acesso_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
    pessoa           Pessoa       @relation(fields: [pessoa_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

    @@map("pessoa_perfil")
}

model PessoaSessaoAtiva {
    id        Int    @id @default(autoincrement())
    pessoa_id Int
    pessoa    Pessoa @relation(fields: [pessoa_id], references: [id])

    @@map("pessoa_sessao_ativa")
}

model Privilegio {
    id                Int                @id @default(autoincrement())
    nome              String
    codigo            String             @unique
    modulo_id         Int
    modulo            Modulo             @relation(fields: [modulo_id], references: [id])
    perfil_privilegio PerfilPrivilegio[]

    @@map("privilegio")
}

model TipoOrgao {
    id        Int     @id @default(autoincrement())
    descricao String
    orgao     Orgao[]

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    @@map("tipo_orgao")
}

model EmaildbConfig {
    id                       Int                     @id @default(autoincrement())
    from                     String
    template_resolver_class  String                  @db.VarChar(60)
    template_resolver_config Json                    @default("{}") @db.Json
    email_transporter_class  String                  @db.VarChar(60)
    email_transporter_config Json                    @default("{}") @db.Json
    delete_after             Unsupported("interval") @default(dbgenerated("'10 years'::interval"))
    EmaildbQueue             EmaildbQueue[]

    @@map("emaildb_config")
}

model EmaildbQueue {
    id             String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
    config_id      Int
    created_at     DateTime      @default(now()) @db.Timestamp(6)
    template       String
    to             String
    subject        String
    variables      Json          @db.Json
    sent           Boolean?
    updated_at     DateTime?     @db.Timestamp(6)
    visible_after  DateTime?     @db.Timestamp(6)
    errmsg         String?
    emaildb_config EmaildbConfig @relation(fields: [config_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

    @@map("emaildb_queue")
}

model Ods {
    id Int @id @default(autoincrement())

    numero    Int
    titulo    String
    descricao String

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])
    Tag         Tag[]

    @@map("ods")
}

model Pdm {
    id Int @id @default(autoincrement())

    nome                                  String
    descricao                             String?
    data_inicio                           DateTime? @db.Date()
    data_fim                              DateTime? @db.Date()
    data_publicacao                       DateTime? @db.Date()
    periodo_do_ciclo_participativo_inicio DateTime? @db.Date()
    periodo_do_ciclo_participativo_fim    DateTime? @db.Date()
    ativo                                 Boolean   @default(false)

    prefeito       String
    equipe_tecnica String?

    possui_macro_tema          Boolean @default(true)
    possui_tema                Boolean @default(true)
    possui_sub_tema            Boolean @default(true)
    possui_contexto_meta       Boolean @default(true)
    possui_complementacao_meta Boolean @default(true)
    possui_iniciativa          Boolean @default(false)
    possui_atividade           Boolean @default(false)

    rotulo_macro_tema          String @default("Macro Tema")
    rotulo_tema                String @default("Tema")
    rotulo_sub_tema            String @default("Sub Tema")
    rotulo_contexto_meta       String @default("Contexto")
    rotulo_complementacao_meta String @default("Complementação")
    rotulo_iniciativa          String @default("Iniciativa")
    rotulo_atividade           String @default("Atividade")

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    desativado_por Int?
    desativado_em  DateTime? @db.Timestamptz(6)

    atualizador         Pessoa?            @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador             Pessoa?            @relation("Criador", fields: [criado_por], references: [id])
    desativador         Pessoa?            @relation("Desativador", fields: [desativado_por], references: [id])
    Eixo                MacroTema[]
    Tag                 Tag[]
    ObjetivoEstrategico Tema[]
    ArquivoDocumento    ArquivoDocumento[]
    SubTema             SubTema[]
    Meta                Meta[]

    logo                String?
    arquivo_logo_id     Int?
    ArquivoLogo         Arquivo?              @relation(fields: [arquivo_logo_id], references: [id])
    CicloFasesPdmConfig CicloFasesPdmConfig[]
    CicloFisico         CicloFisico[]

    @@map("pdm")
}

model MacroTema {
    id Int @id @default(autoincrement())

    descricao String

    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])
    Meta        Meta[]

    @@map("eixo")
}

model SubTema {
    id Int @id @default(autoincrement())

    descricao String

    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])
    Meta        Meta[]

    @@map("subtema")
}

model FonteRecurso {
    id    Int     @id @default(autoincrement())
    fonte String
    sigla String?

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    @@map("fonte_recurso")
}

model TipoDocumento {
    id        Int     @id @default(autoincrement())
    codigo    String
    titulo    String
    descricao String?
    extensoes String?

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa?   @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa?   @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa?   @relation("Removedor", fields: [removido_por], references: [id])
    Arquivo     Arquivo[]

    @@map("tipo_documento")
}

model Tag {
    id Int @id @default(autoincrement())

    descricao String
    icone     String?

    arquivo_icone_id Int?
    ArquivoIcone     Arquivo? @relation(fields: [arquivo_icone_id], references: [id])

    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    ods_id Int?
    ods    Ods? @relation(fields: [ods_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    meta_tag       MetaTag[]
    iniciativa_tag IniciativaTag[]
    atividade_tag  AtividadeTag[]

    @@map("tag")
}

model Tema {
    id Int @id @default(autoincrement())

    descricao String

    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])
    Meta        Meta[]

    @@map("objetivo_estrategico")
}

model Regiao {
    id Int @id @default(autoincrement())

    descricao  String
    shapefile  String?
    nivel      Int
    codigo     Int?
    parente_id Int?

    arquivo_shapefile_id Int?
    ArquivoShapefile     Arquivo? @relation(fields: [arquivo_shapefile_id], references: [id])

    RegiaoAcima Regiao? @relation("Parente", fields: [parente_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador   Pessoa?    @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador       Pessoa?    @relation("Criador", fields: [criado_por], references: [id])
    removedor     Pessoa?    @relation("Removedor", fields: [removido_por], references: [id])
    RegioesAbaixo Regiao[]   @relation("Parente")
    Variavel      Variavel[]
    Etapa         Etapa[]

    @@map("regiao")
}

model Arquivo {
    id   Int    @id @default(autoincrement())
    tipo String

    criador                         Pessoa?                           @relation("Criador", fields: [criado_por], references: [id])
    criado_por                      Int?
    criado_em                       DateTime                          @default(now()) @db.Timestamptz(6)
    caminho                         String
    nome_original                   String
    mime_type                       String?
    tamanho_bytes                   Int
    descricao                       String?
    tipo_documento_id               Int?
    TipoDocumento                   TipoDocumento?                    @relation(fields: [tipo_documento_id], references: [id])
    Tag                             Tag[]
    Regiao                          Regiao[]
    ArquivoDocumento                ArquivoDocumento[]
    Pdm                             Pdm[]
    VariavelCicloFisicoDocumento    VariavelCicloFisicoDocumento[]
    MetaCicloFisicoAnaliseDocumento MetaCicloFisicoAnaliseDocumento[]

    @@map("arquivo")
}

model ArquivoDocumento {
    id Int @id @default(autoincrement())

    arquivo_id Int
    arquivo    Arquivo @relation(fields: [arquivo_id], references: [id])

    pdm_id Int?
    pdm    Pdm? @relation(fields: [pdm_id], references: [id])

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    @@map("arquivo_documento")
}

model Meta {
    id Int @id @default(autoincrement())

    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    status      String
    codigo      String
    titulo      String
    contexto    String?
    complemento String?

    macro_tema_id Int?
    macro_tema    MacroTema? @relation(fields: [macro_tema_id], references: [id])
    tema_id       Int?
    tema          Tema?      @relation(fields: [tema_id], references: [id])
    sub_tema_id   Int?
    sub_tema      SubTema?   @relation(fields: [sub_tema_id], references: [id])

    ativo Boolean @default(false)

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    ciclo_fisico_id Int?
    ciclo_fisico    CicloFisico? @relation(fields: [ciclo_fisico_id], references: [id])

    ciclo_fase_id Int?
    ciclo_fase    CicloFisicoFase? @relation(fields: [ciclo_fase_id], references: [id])

    atualizador      Pessoa?           @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador          Pessoa?           @relation("Criador", fields: [criado_por], references: [id])
    reovedor         Pessoa?           @relation("Desativador", fields: [removido_por], references: [id])
    meta_orgao       MetaOrgao[]
    meta_responsavel MetaResponsavel[]
    indicador        Indicador[]
    iniciativa       Iniciativa[]
    meta_tag         MetaTag[]

    cronograma                      Cronograma[]
    painel_conteudo                 PainelConteudo[]
    StatusMetaCicloFisico           StatusMetaCicloFisico[]
    StatusVariavelCicloFisico       StatusVariavelCicloFisico[]
    VariavelCicloFisicoQualitativo  VariavelCicloFisicoQualitativo[]
    VariavelCicloFisicoDocumento    VariavelCicloFisicoDocumento[]
    MetaCicloFisicoAnalise          MetaCicloFisicoAnalise[]
    MetaCicloFisicoAnaliseDocumento MetaCicloFisicoAnaliseDocumento[]
    MetaCicloFisicoRisco            MetaCicloFisicoRisco[]
    MetaCicloFisicoFechamento       MetaCicloFisicoFechamento[]

    @@index([pdm_id])
    @@map("meta")
}

model MetaTag {
    id      Int  @id @default(autoincrement())
    meta_id Int
    meta    Meta @relation(fields: [meta_id], references: [id])
    tag_id  Int
    tag     Tag  @relation(fields: [tag_id], references: [id])

    @@map("meta_tag")
}

model MetaOrgao {
    id Int @id @default(autoincrement())

    meta_id     Int
    meta        Meta    @relation(fields: [meta_id], references: [id])
    responsavel Boolean
    orgao_id    Int
    orgao       Orgao   @relation(fields: [orgao_id], references: [id])

    @@map("meta_orgao")
}

model MetaResponsavel {
    id Int @id @default(autoincrement())

    meta_id   Int
    meta      Meta   @relation(fields: [meta_id], references: [id])
    pessoa_id Int
    pessoa    Pessoa @relation("MetaPessoaResp", fields: [pessoa_id], references: [id])
    orgao_id  Int
    orgao     Orgao  @relation(fields: [orgao_id], references: [id])

    // TODO: arrumar o nome desta coluna, palavra 'coordenador'.
    coorderandor_responsavel_cp Boolean

    @@index([pessoa_id])
    @@map("meta_responsavel")
}

enum Polaridade {
    Neutra
    Positiva
    Negativa
}

enum Periodicidade {
    Mensal
    Bimestral
    Trimestral
    Quadrimestral
    Semestral
    Anual
    Quinquenal
    Secular
}

model Indicador {
    id                    Int           @id @default(autoincrement())
    meta_id               Int?
    meta                  Meta?         @relation(fields: [meta_id], references: [id])
    iniciativa_id         Int?
    iniciativa            Iniciativa?   @relation(fields: [iniciativa_id], references: [id])
    atividade_id          Int?
    atividade             Atividade?    @relation(fields: [atividade_id], references: [id])
    formula               String?
    formula_compilada     String?
    acumulado_valor_base  Decimal?      @db.Decimal(65, 30)
    acumulado_usa_formula Boolean       @default(false)
    codigo                String
    titulo                String
    periodicidade         Periodicidade
    polaridade            Polaridade    @default(Neutra)
    regionalizavel        Boolean       @default(false)
    nivel_regionalizacao  Int?
    inicio_medicao        DateTime      @db.Date()
    fim_medicao           DateTime      @db.Date()
    criado_por            Int?
    criado_em             DateTime      @default(now()) @db.Timestamptz(6)
    atualizado_por        Int?
    atualizado_em         DateTime      @default(now()) @db.Timestamptz(6)
    removido_por          Int?
    removido_em           DateTime?     @db.Timestamptz(6)
    contexto              String?
    complemento           String?
    casas_decimais        Int?          @db.SmallInt

    atualizador             Pessoa?                    @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador                 Pessoa?                    @relation("Criador", fields: [criado_por], references: [id])
    removedor               Pessoa?                    @relation("Removedor", fields: [removido_por], references: [id])
    IndicadorVariavelOrigem IndicadorVariavel[]        @relation("Origem")
    IndicadorVariavel       IndicadorVariavel[]        @relation("FK")
    SerieIndicador          SerieIndicador[]
    formula_variaveis       IndicadorFormulaVariavel[]
    painel_conteudo         PainelConteudo[]

    @@index([meta_id])
    @@index([iniciativa_id])
    @@index([atividade_id])
    @@map("indicador")
}

model IndicadorFormulaVariavel {
    id                   Int       @id @default(autoincrement())
    referencia           String
    indicador_id         Int
    indicador            Indicador @relation(fields: [indicador_id], references: [id])
    variavel_id          Int
    variavel             Variavel  @relation(fields: [variavel_id], references: [id])
    janela               Int
    usar_serie_acumulada Boolean   @default(false)

    @@unique([indicador_id, referencia])
    @@map("indicador_formula_variavel")
}

enum Serie {
    Previsto
    PrevistoAcumulado
    Realizado
    RealizadoAcumulado
}

model UnidadeMedida {
    id        Int        @id @default(autoincrement())
    sigla     String
    descricao String
    Variavel  Variavel[]

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    @@map("unidade_medida")
}

model VariavelResponsavel {
    id Int @id @default(autoincrement())

    variavel_id Int
    pessoa_id   Int

    pessoa   Pessoa   @relation(fields: [pessoa_id], references: [id])
    variavel Variavel @relation(fields: [variavel_id], references: [id])

    @@index([pessoa_id])
    @@map("variavel_responsavel")
}

model Variavel {
    id                Int           @id @default(autoincrement())
    orgao_id          Int
    orgao             Orgao         @relation(fields: [orgao_id], references: [id])
    regiao_id         Int?
    //a regiao por agora, o usuario precisa criar cada uma das variaveis manualmente
    regiao            Regiao?       @relation(fields: [regiao_id], references: [id])
    titulo            String
    // qual é o valor que o valor base se refere
    ano_base          Int?
    valor_base        Decimal       @db.Decimal(65, 30) // onde o grafico começa
    periodicidade     Periodicidade
    unidade_medida_id Int
    unidade_medida    UnidadeMedida @relation(fields: [unidade_medida_id], references: [id])

    codigo String

    // ficam null quando a Periodicidade é a mesma do indicador
    // quando for diferente, é necessário preencher para saber qual é o mês de base
    inicio_medicao DateTime? @db.Date()
    fim_medicao    DateTime? @db.Date()

    casas_decimais             Int                         @default(0) @db.SmallInt
    // usar para calculcar as agregações, por exemplo na média ponderada
    // acho que pode ser um valor e não uma porcentagem, e ai o sistema calcula a porcentagem sozinho
    // de acordo com o numero de variaveis
    acumulativa                Boolean                     @default(false)
    // quando true, o sistema vai calcular automaticamente a serie acumulativa
    // quando false, o usuario precisa preencher, mas sempre via ter as 4 series, correto?
    serie_variavel             SerieVariavel[]
    variavel_responsavel       VariavelResponsavel[]
    indicador_variavel         IndicadorVariavel[]
    indicador_formula_variavel IndicadorFormulaVariavel[]
    PainelConteudoDetalhe      PainelConteudoDetalhe[]
    StatusVariavelCicloFisico  StatusVariavelCicloFisico[]

    // quanto tempo leva para o preenchimento da variavel
    // geralmente é 1, ou seja, numa variavel mensal, no ciclo de novembro, se preenche os valores de outubro
    atraso_meses                   Int                              @default(1) @db.Integer
    VariavelCicloFisicoQualitativo VariavelCicloFisicoQualitativo[]
    VariavelCicloFisicoDocumento   VariavelCicloFisicoDocumento[]
    PedidoComplementacao           PedidoComplementacao[]

    @@map("variavel")
}

// cria relacionamento com um indicador (ou iniciativa que ainda nao existe) com a variavel

model IndicadorVariavel {
    id Int @id @default(autoincrement())

    indicador_id Int
    indicador    Indicador @relation("FK", fields: [indicador_id], references: [id])

    variavel_id Int
    variavel    Variavel @relation(fields: [variavel_id], references: [id])

    indicador_origem_id Int?
    indicador_origem    Indicador? @relation("Origem", fields: [indicador_origem_id], references: [id])

    desativado     Boolean   @default(false)
    desativado_em  DateTime?
    desativado_por Int?
    desativador    Pessoa?   @relation("Desativador", fields: [desativado_por], references: [id])

    @@index([variavel_id], map: "idx_indicador_variavel_variavel")
    @@index([indicador_id], map: "idx_indicador_variavel_indicador")
    @@map("indicador_variavel")
}

// valores calculados pelo sistema, deixar vazio por enquanto Lucas
model SerieIndicador {
    id           Int       @id @default(autoincrement())
    indicador_id Int
    indicador    Indicador @relation(fields: [indicador_id], references: [id])

    serie Serie

    data_valor              DateTime @db.Date()
    valor_nominal           Float    @db.DoublePrecision
    ha_conferencia_pendente Boolean  @default(false)

    @@index([serie, indicador_id, data_valor], map: "idx_serie_indicador_indicador_id_data_valor")
    @@index([indicador_id, data_valor], map: "idx_indicador_indicador_id_data_valor")
    @@map("serie_indicador")
}

model SerieVariavel {
    id          Int      @id @default(autoincrement())
    variavel_id Int
    variavel    Variavel @relation(fields: [variavel_id], references: [id])

    serie Serie

    data_valor    DateTime @db.Date()
    valor_nominal Decimal  @db.Decimal(65, 30)

    atualizado_em  DateTime @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizador    Pessoa?  @relation("Atualizador", fields: [atualizado_por], references: [id])

    conferida     Boolean   @default(true)
    conferida_por Int?
    conferida_em  DateTime?

    conferidor      Pessoa? @relation("Conferidor", fields: [conferida_por], references: [id])
    ciclo_fisico_id Int?

    @@index([serie, variavel_id, data_valor], map: "idx_serie_variavel_variavel_id_data_valor")
    @@map("serie_variavel")
}

model Iniciativa {
    id                    Int     @id @default(autoincrement())
    meta_id               Int
    meta                  Meta    @relation(fields: [meta_id], references: [id])
    codigo                String
    titulo                String
    contexto              String?
    complemento           String?
    compoe_indicador_meta Boolean
    status                String?

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    ativo Boolean @default(false)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    iniciativa_orgao       IniciativaOrgao[]
    iniciativa_responsavel IniciativaResponsavel[]
    iniciativa_tag         IniciativaTag[]
    Indicador              Indicador[]
    atividade              Atividade[]
    Cronograma             Cronograma[]
    PainelConteudoDetalhe  PainelConteudoDetalhe[]

    @@map("iniciativa")
}

model IniciativaTag {
    id            Int        @id @default(autoincrement())
    iniciativa_id Int
    iniciativa    Iniciativa @relation(fields: [iniciativa_id], references: [id])
    tag_id        Int
    tag           Tag        @relation(fields: [tag_id], references: [id])

    @@map("iniciativa_tag")
}

model IniciativaOrgao {
    id Int @id @default(autoincrement())

    iniciativa_id Int
    iniciativa    Iniciativa @relation(fields: [iniciativa_id], references: [id])
    responsavel   Boolean
    orgao_id      Int
    orgao         Orgao      @relation(fields: [orgao_id], references: [id])

    @@map("iniciativa_orgao")
}

model IniciativaResponsavel {
    id Int @id @default(autoincrement())

    iniciativa_id Int
    iniciativa    Iniciativa @relation(fields: [iniciativa_id], references: [id])
    pessoa_id     Int
    pessoa        Pessoa     @relation("IniciativaPessoaResp", fields: [pessoa_id], references: [id])
    orgao_id      Int
    orgao         Orgao      @relation(fields: [orgao_id], references: [id])

    coordenador_responsavel_cp Boolean

    @@map("iniciativa_responsavel")
}

model Atividade {
    id                          Int        @id @default(autoincrement())
    iniciativa_id               Int
    iniciativa                  Iniciativa @relation(fields: [iniciativa_id], references: [id])
    codigo                      String
    titulo                      String
    contexto                    String?
    complemento                 String?
    compoe_indicador_iniciativa Boolean
    status                      String?

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    ativo Boolean @default(false)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    atividade_orgao       AtividadeOrgao[]
    atividade_responsavel AtividadeResponsavel[]
    atividade_tag         AtividadeTag[]
    Indicador             Indicador[]
    Cronograma            Cronograma[]
    PainelConteudoDetalhe PainelConteudoDetalhe[]

    @@map("atividade")
}

model AtividadeTag {
    id           Int       @id @default(autoincrement())
    atividade_id Int
    atividade    Atividade @relation(fields: [atividade_id], references: [id])
    tag_id       Int
    tag          Tag       @relation(fields: [tag_id], references: [id])

    @@map("atividade_tag")
}

model AtividadeOrgao {
    id Int @id @default(autoincrement())

    atividade_id Int
    atividade    Atividade @relation(fields: [atividade_id], references: [id])
    responsavel  Boolean
    orgao_id     Int
    orgao        Orgao     @relation(fields: [orgao_id], references: [id])

    @@map("atividade_orgao")
}

model AtividadeResponsavel {
    id Int @id @default(autoincrement())

    atividade_id Int
    atividade    Atividade @relation(fields: [atividade_id], references: [id])
    pessoa_id    Int
    pessoa       Pessoa    @relation("AtividadePessoaResp", fields: [pessoa_id], references: [id])
    orgao_id     Int
    orgao        Orgao     @relation(fields: [orgao_id], references: [id])

    coordenador_responsavel_cp Boolean

    @@map("atividade_responsavel")
}

model Cronograma {
    id Int @id @default(autoincrement())

    meta_id       Int?
    meta          Meta?       @relation(fields: [meta_id], references: [id])
    iniciativa_id Int?
    iniciativa    Iniciativa? @relation(fields: [iniciativa_id], references: [id])
    atividade_id  Int?
    atividade     Atividade?  @relation(fields: [atividade_id], references: [id])

    descricao            String?
    observacao           String?
    inicio_previsto      DateTime?         @db.Date()
    termino_previsto     DateTime?         @db.Date()
    inicio_real          DateTime?         @db.Date()
    termino_real         DateTime?         @db.Date()
    regionalizavel       Boolean
    nivel_regionalizacao Int?
    CronogramaOrgao      CronogramaOrgao[]
    CronogramaEtapa      CronogramaEtapa[]

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    ativo Boolean @default(false)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    etapa Etapa[]

    @@map("cronograma")
}

model Etapa {
    id Int @id @default(autoincrement())

    etapa_pai_id  Int?
    etapa_pai     Etapa?     @relation("EtapaPai", fields: [etapa_pai_id], references: [id])
    etapa_filha   Etapa[]    @relation("EtapaPai")
    regiao_id     Int?
    regiao        Regiao?    @relation(fields: [regiao_id], references: [id])
    cronograma_id Int
    cronograma    Cronograma @relation(fields: [cronograma_id], references: [id])

    titulo           String?
    nivel            String?
    descricao        String?
    inicio_previsto  DateTime?         @db.Date()
    termino_previsto DateTime?         @db.Date()
    inicio_real      DateTime?         @db.Date()
    termino_real     DateTime?         @db.Date()
    prazo            Int?
    peso             Int?
    status           String?
    CronogramaEtapa  CronogramaEtapa[]

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador Pessoa? @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador     Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor   Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    @@map("etapa")
}

model CronogramaOrgao {
    id Int @id @default(autoincrement())

    cronograma_id Int
    cronograma    Cronograma @relation(fields: [cronograma_id], references: [id])
    orgao_id      Int
    orgao         Orgao      @relation(fields: [orgao_id], references: [id])
    pessoa_id     Int
    pessoa        Pessoa     @relation(fields: [pessoa_id], references: [id])

    @@map("cronograma_orgao")
}

model CronogramaEtapa {
    id Int @id @default(autoincrement())

    cronograma_id Int
    cronograma    Cronograma @relation(fields: [cronograma_id], references: [id])
    etapa_id      Int
    etapa         Etapa      @relation(fields: [etapa_id], references: [id])
    ordem         Int?

    inativo         Boolean   @default(false)
    data_inativacao DateTime? @db.Timestamptz(6)

    @@unique([cronograma_id, etapa_id], name: "CronogramaEtapaUniq")
    @@map("cronograma_etapa")
}

model Painel {
    id Int @id @default(autoincrement())

    nome          String
    periodicidade Periodicidade
    ativo         Boolean       @default(true)

    mostrar_planejado_por_padrao Boolean @default(true)
    mostrar_acumulado_por_padrao Boolean @default(true)
    mostrar_indicador_por_padrao Boolean @default(true)

    criado_por     Int?
    criado_em      DateTime  @default(now()) @db.Timestamptz(6)
    atualizado_por Int?
    atualizado_em  DateTime  @default(now()) @db.Timestamptz(6)
    removido_por   Int?
    removido_em    DateTime? @db.Timestamptz(6)

    atualizador     Pessoa?          @relation("Atualizador", fields: [atualizado_por], references: [id])
    criador         Pessoa?          @relation("Criador", fields: [criado_por], references: [id])
    removedor       Pessoa?          @relation("Removedor", fields: [removido_por], references: [id])
    painel_conteudo PainelConteudo[]

    grupos PainelGrupoPainel[]

    @@map("painel")
}

enum Periodo {
    Corrente
    Anteriores
    Todos
    EntreDatas
}

model PainelConteudo {
    id Int @id @default(autoincrement())

    painel_id Int
    painel    Painel @relation(fields: [painel_id], references: [id])

    meta_id Int
    meta    Meta @relation(fields: [meta_id], references: [id])

    periodicidade  Periodicidade
    periodo        Periodo       @default(Todos)
    periodo_valor  Int?
    periodo_inicio DateTime?     @db.Date
    periodo_fim    DateTime?     @db.Date

    mostrar_planejado         Boolean
    mostrar_acumulado         Boolean
    mostrar_indicador         Boolean
    mostrar_acumulado_periodo Boolean                 @default(false)
    ordem                     Int?
    detalhes                  PainelConteudoDetalhe[]
    indicador                 Indicador?              @relation(fields: [indicador_id], references: [id])
    indicador_id              Int?

    @@map("painel_conteudo")
}

enum PainelConteudoTipoDetalhe {
    Variavel
    Iniciativa
    Atividade
}

model PainelConteudoDetalhe {
    id Int @id @default(autoincrement())

    variavel_id        Int?
    variavel           Variavel?              @relation(fields: [variavel_id], references: [id])
    iniciativa_id      Int?
    iniciativa         Iniciativa?            @relation(fields: [iniciativa_id], references: [id])
    atividade_id       Int?
    atividade          Atividade?             @relation(fields: [atividade_id], references: [id])
    painel_conteudo_id Int
    painel_conteudo    PainelConteudo         @relation(fields: [painel_conteudo_id], references: [id], onDelete: Cascade)
    pai_id             Int?
    pai                PainelConteudoDetalhe? @relation("fk", fields: [pai_id], references: [id], onDelete: Cascade)

    mostrar_indicador Boolean

    ordem  Int?
    tipo   PainelConteudoTipoDetalhe
    filhos PainelConteudoDetalhe[]   @relation("fk")

    @@map("painel_conteudo_detalhe")
}

model GrupoPainel {
    id Int @id @default(autoincrement())

    nome  String  @unique
    ativo Boolean @default(true)

    criado_por   Int?
    criado_em    DateTime  @default(now()) @db.Timestamptz(6)
    removido_por Int?
    removido_em  DateTime? @db.Timestamptz(6)

    criador   Pessoa? @relation("Criador", fields: [criado_por], references: [id])
    removedor Pessoa? @relation("Removedor", fields: [removido_por], references: [id])

    pessoas PessoaGrupoPainel[]
    paineis PainelGrupoPainel[]

    @@map("grupo_painel")
}

model PessoaGrupoPainel {
    id Int @id @default(autoincrement())

    pessoa_id       Int
    pessoa          Pessoa      @relation(fields: [pessoa_id], references: [id])
    grupo_painel_id Int
    grupo_painel    GrupoPainel @relation(fields: [grupo_painel_id], references: [id])

    @@map("pessoa_grupo_painel")
}

model PainelGrupoPainel {
    id Int @id @default(autoincrement())

    painel_id       Int
    painel          Painel      @relation(fields: [painel_id], references: [id])
    grupo_painel_id Int
    grupo_painel    GrupoPainel @relation(fields: [grupo_painel_id], references: [id])

    @@map("painel_grupos")
}

enum CicloFase {
    Coleta
    Analise
    Risco
    Fechamento
}

// tabela de origem dos intervalos padrões
model CicloFasesBase {
    id Int @id @default(autoincrement())

    ciclo_fase CicloFase @unique

    n_dias_do_inicio_mes Int
    duracao              Int // quando negativo, vai subtrair do final do mes

    @@map("ciclo_fases_base")
}

// se um dia quiser sobre-escrever em um PDM
model CicloFasesPdmConfig {
    id     Int @id @default(autoincrement())
    pdm_id Int
    pdm    Pdm @relation(fields: [pdm_id], references: [id])

    ciclo_fase CicloFase

    n_dias_do_inicio_mes Int
    duracao              Int

    @@map("ciclo_fases_pdm_config")
}

// ciclos após abertura
model CicloFisico {
    id Int @id @default(autoincrement())

    pdm_id              Int
    pdm                 Pdm              @relation(fields: [pdm_id], references: [id])
    data_ciclo          DateTime         @db.Date()
    ciclo_fase_atual_id Int?
    ciclo_fase_atual    CicloFisicoFase? @relation("atual", fields: [ciclo_fase_atual_id], references: [id])
    ativo               Boolean          @default(false)

    acordar_ciclo_em                DateTime?
    acordar_ciclo_errmsg            String?
    acordar_ciclo_executou_em       DateTime?
    fases                           CicloFisicoFase[]                 @relation("fk")
    metas                           Meta[]
    StatusMetaCicloFisico           StatusMetaCicloFisico[]
    StatusVariavelCicloFisico       StatusVariavelCicloFisico[]
    VariavelCicloFisicoQualitativo  VariavelCicloFisicoQualitativo[]
    VariavelCicloFisicoDocumento    VariavelCicloFisicoDocumento[]
    PedidoComplementacao            PedidoComplementacao[]
    MetaCicloFisicoAnalise          MetaCicloFisicoAnalise[]
    MetaCicloFisicoAnaliseDocumento MetaCicloFisicoAnaliseDocumento[]
    MetaCicloFisicoRisco            MetaCicloFisicoRisco[]
    MetaCicloFisicoFechamento       MetaCicloFisicoFechamento[]

    @@map("ciclo_fisico")
}

// data de cada uma das fases
model CicloFisicoFase {
    id               Int           @id @default(autoincrement())
    ciclo_fisico_id  Int
    ciclo_fisico     CicloFisico   @relation("fk", fields: [ciclo_fisico_id], references: [id])
    cf_estou_em_usos CicloFisico[] @relation("atual") @ignore

    data_inicio DateTime  @db.Date()
    data_fim    DateTime  @db.Date()
    ciclo_fase  CicloFase
    metas       Meta[]

    @@map("ciclo_fisico_fase")
}

model PessoaAcessoPdm {
    id        Int @id @default(autoincrement())
    pessoa_id Int @unique

    metas_cronograma   Int[]
    metas_variaveis    Int[]
    variaveis          Int[]
    cronogramas_etapas Int[]

    data_ciclo DateTime? @db.Date
    perfil     String

    // se o valor estiver congelado, para debug, não vamos recalcular as permissões
    // exceto se for mudança de ciclo, nesse caso, vai recacular anyway
    congelado Boolean

    pessoa Pessoa @relation(fields: [pessoa_id], references: [id])

    @@map("pessoa_acesso_pdm")
}

model MetaCicloFisicoAnalise {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int

    referencia_data            DateTime @db.Date
    informacoes_complementares String?

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    ultima_revisao Boolean

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@index([meta_id, ultima_revisao])
    @@map("meta_ciclo_fisico_analise")
}

model MetaCicloFisicoAnaliseDocumento {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int

    referencia_data DateTime @db.Date

    arquivo_id Int
    arquivo    Arquivo @relation(fields: [arquivo_id], references: [id])

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@index([ciclo_fisico_id])
    @@map("meta_ciclo_fisico_analise_documento")
}

model MetaCicloFisicoRisco {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int

    referencia_data  DateTime @db.Date
    detalhamento     String?
    ponto_de_atencao String?

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    ultima_revisao Boolean

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@index([meta_id, ultima_revisao])
    @@map("meta_ciclo_fisico_risco")
}

model MetaCicloFisicoFechamento {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int

    referencia_data  DateTime @db.Date
    comentario     String?

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    ultima_revisao Boolean

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@index([meta_id, ultima_revisao])
    @@map("meta_ciclo_fisico_fechamento")
}

model VariavelCicloFisicoQualitativo {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int
    variavel_id     Int

    referencia_data     DateTime @db.Date
    analise_qualitativa String?
    enviado_para_cp     Boolean

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    ultima_revisao Boolean

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    variavel        Variavel    @relation(fields: [variavel_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@index([meta_id, ultima_revisao])
    @@map("variavel_ciclo_fisico_qualitativo")
}

model PedidoComplementacao {
    id              Int @id @default(autoincrement())
    ciclo_fisico_id Int
    variavel_id     Int

    pedido String

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    ultima_revisao Boolean
    atendido       Boolean
    atendido_em    DateTime?
    atendido_por   Int?

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    variavel        Variavel    @relation(fields: [variavel_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaAtendeu   Pessoa?     @relation("atendeu", fields: [atendido_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@map("variavel_ciclo_fisico_pedido_complementacao")
}

model VariavelCicloFisicoDocumento {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int
    variavel_id     Int

    referencia_data DateTime @db.Date

    arquivo_id Int
    arquivo    Arquivo @relation(fields: [arquivo_id], references: [id])

    criado_em  DateTime @default(now()) @db.Timestamptz(6)
    criado_por Int

    removido_em  DateTime?
    removido_por Int?

    ciclo_fisico    CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta            Meta        @relation(fields: [meta_id], references: [id])
    variavel        Variavel    @relation(fields: [variavel_id], references: [id])
    pessoaCriador   Pessoa      @relation("criador", fields: [criado_por], references: [id])
    pessoaRemovedor Pessoa?     @relation("removedor", fields: [removido_por], references: [id])

    @@map("variavel_ciclo_fisico_documento")
}

model StatusVariavelCicloFisico {
    id                     Int     @id @default(autoincrement())
    meta_id                Int
    ciclo_fisico_id        Int
    variavel_id            Int
    aguarda_cp             Boolean @default(false)
    aguarda_complementacao Boolean @default(false)

    ciclo_fisico CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta         Meta        @relation(fields: [meta_id], references: [id])
    variavel     Variavel    @relation(fields: [variavel_id], references: [id])

    @@map("status_variavel_ciclo_fisico")
}

model StatusMetaCicloFisico {
    id              Int @id @default(autoincrement())
    meta_id         Int
    ciclo_fisico_id Int

    status_coleta     String @default("")
    // nao atualizadas = uma ou mais variaveis não preenchida
    // aguardando complementação = uma ou mais variavel aguarda complementação
    // não conferidas = uma ou mais variavel não foi conferida
    // outros = qualquer uma não categorizada acima
    status_cronograma String @default("")

    status_valido Boolean @default(false)

    ciclo_fisico CicloFisico @relation(fields: [ciclo_fisico_id], references: [id])
    meta         Meta        @relation(fields: [meta_id], references: [id])

    @@map("status_meta_ciclo_fisico")
}
